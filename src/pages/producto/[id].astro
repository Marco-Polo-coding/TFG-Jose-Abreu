---
import Layout from '../../layouts/Layout.astro';
import ProductoDetalle from '../../components/ProductoDetalle';

export async function getStaticPaths() {
  try {
    const response = await fetch('http://localhost:8000/productos');
    const data = await response.json();
    
    console.log('Respuesta de la API de productos:', data);
    
    // Verificar si data.productos existe y es un objeto
    if (!data || !data.productos || typeof data.productos !== 'object') {
      console.error('La respuesta de la API no tiene el formato esperado:', data);
      return [];
    }
    
    // Obtener todos los IDs de productos del objeto
    const paths = Object.keys(data.productos).map(id => ({
      params: { id }
    }));

    console.log('Paths generados:', paths);
    return paths;
  } catch (error) {
    console.error('Error al obtener los IDs de productos:', error);
    return [];
  }
}

const { id } = Astro.params;
---

<Layout>
  <ProductoDetalle client:load id={id} />
</Layout> 